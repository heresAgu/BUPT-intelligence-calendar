<!-- pages/assignment/assignment.wxml -->
<view class="assignment-page">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input">
      <text class="iconfont icon-search">ğŸ”</text>
      <input 
        placeholder="æœç´¢ä½œä¸šæˆ–è¯¾ç¨‹" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        placeholder-class="placeholder"
      />
    </view>
    <view class="filter-btn" bindtap="showFilterPanel">
      <text class="iconfont icon-filter">ç­›é€‰</text>
    </view>
  </view>

  <!-- ç­›é€‰æ ‡ç­¾ -->
  <scroll-view class="filter-tags" scroll-x="true">
    <view 
      class="filter-tag {{activeFilter === 'all' ? 'active' : ''}}"
      bindtap="changeFilter"
      data-filter="all"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="filter-tag {{activeFilter === 'pending' ? 'active' : ''}}"
      bindtap="changeFilter"
      data-filter="pending"
    >
      æœªå®Œæˆ
    </view>
    <view 
      class="filter-tag {{activeFilter === 'inProgress' ? 'active' : ''}}"
      bindtap="changeFilter"
      data-filter="inProgress"
    >
      è¿›è¡Œä¸­
    </view>
    <view 
      class="filter-tag {{activeFilter === 'completed' ? 'active' : ''}}"
      bindtap="changeFilter"
      data-filter="completed"
    >
      å·²å®Œæˆ
    </view>
    <view 
      class="filter-tag {{activeFilter === 'overdue' ? 'active' : ''}}"
      bindtap="changeFilter"
      data-filter="overdue"
    >
      å·²è¿‡æœŸ
    </view>
  </scroll-view>

  <!-- ä½œä¸šåˆ—è¡¨ -->
  <scroll-view class="assignment-list" scroll-y="true">
    <!-- ä»Šæ—¥æˆªæ­¢ -->
    <view class="time-section" wx:if="{{todayAssignments.length > 0}}">
      <view class="section-header">
        <text class="section-title">ğŸ“… ä»Šæ—¥æˆªæ­¢ ({{todayAssignments.length}})</text>
        <text class="section-time">ä»Šå¤© {{todayDate}}</text>
      </view>
      <view class="assignments-group">
        <view 
          class="assignment-card {{item.priorityClass}}"
          wx:for="{{todayAssignments}}"
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="viewAssignmentDetail"
          bindlongpress="onCardLongPress"
          data-index="{{index}}"
        >
          <view class="card-header">
            <view class="assignment-title">{{item.title}}</view>
            <view class="priority-badge priority-{{item.priority}}">
              {{['ä½','ä¸­','é«˜'][item.priority]}}
            </view>
          </view>
          <view class="card-body">
            <view class="course-info">
              <text class="iconfont icon-book">ğŸ“š</text>
              <text class="course-name">{{item.courseName || 'æœªåˆ†ç±»'}}</text>
            </view>
            <view class="due-info">
              <text class="iconfont icon-time">â°</text>
              <text class="due-text">æˆªæ­¢ï¼š{{item.formattedDueTime}}</text>
              <text class="time-left {{item.urgentClass}}">
                {{item.timeLeftText}}
              </text>
            </view>
          </view>
          <view class="card-footer">
            <view class="status-tag status-{{item.status}}">
              {{['æœªå¼€å§‹','è¿›è¡Œä¸­','å·²å®Œæˆ'][item.status]}}
            </view>
            <view class="action-buttons">
              <button 
                class="btn-quick-action" 
                size="mini"
                data-id="{{item.id}}"
                bindtap="markAsComplete"
                catchtap
                wx:if="{{item.status !== 2}}"
              >
                æ ‡è®°å®Œæˆ
              </button>
              <button 
                class="btn-quick-action" 
                size="mini" 
                plain
                data-id="{{item.id}}"
                bindtap="editAssignment"
                catchtap
              >
                ç¼–è¾‘
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœ¬å‘¨ä½œä¸š - ä½¿ç”¨å®Œæ•´çš„ç»“æ„ -->
    <view class="time-section" wx:if="{{weekAssignments.length > 0}}">
      <view class="section-header">
        <text class="section-title">ğŸ—“ï¸ æœ¬å‘¨ä½œä¸š ({{weekAssignments.length}})</text>
        <text class="section-time">æœ¬å‘¨å‰©ä½™</text>
      </view>
      <view class="assignments-group">
        <view 
          class="assignment-card {{item.priorityClass}}"
          wx:for="{{weekAssignments}}"
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="viewAssignmentDetail"
        >
          <view class="card-header">
            <view class="assignment-title">{{item.title}}</view>
            <view class="priority-badge priority-{{item.priority}}">
              {{['ä½','ä¸­','é«˜'][item.priority]}}
            </view>
          </view>
          <view class="card-body">
            <view class="course-info">
              <text class="iconfont icon-book">ğŸ“š</text>
              <text class="course-name">{{item.courseName || 'æœªåˆ†ç±»'}}</text>
            </view>
            <view class="due-info">
              <text class="iconfont icon-time">â°</text>
              <text class="due-text">æˆªæ­¢ï¼š{{item.formattedDueTime}}</text>
              <text class="time-left {{item.urgentClass}}">
                {{item.timeLeftText}}
              </text>
            </view>
          </view>
          <view class="card-footer">
            <view class="status-tag status-{{item.status}}">
              {{['æœªå¼€å§‹','è¿›è¡Œä¸­','å·²å®Œæˆ'][item.status]}}
            </view>
            <view class="action-buttons">
              <button 
                class="btn-quick-action" 
                size="mini"
                data-id="{{item.id}}"
                bindtap="markAsComplete"
                catchtap
                wx:if="{{item.status !== 2}}"
              >
                æ ‡è®°å®Œæˆ
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åç»­ä½œä¸š -->
    <view class="time-section" wx:if="{{futureAssignments.length > 0}}">
      <view class="section-header">
        <text class="section-title">ğŸ“‹ åç»­ä½œä¸š ({{futureAssignments.length}})</text>
      </view>
      <view class="assignments-group">
        <view 
          class="assignment-card {{item.priorityClass}}"
          wx:for="{{futureAssignments}}"
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="viewAssignmentDetail"
        >
          <view class="card-header">
            <view class="assignment-title">{{item.title}}</view>
            <view class="priority-badge priority-{{item.priority}}">
              {{['ä½','ä¸­','é«˜'][item.priority]}}
            </view>
          </view>
          <view class="card-body">
            <view class="course-info">
              <text class="iconfont icon-book">ğŸ“š</text>
              <text class="course-name">{{item.courseName || 'æœªåˆ†ç±»'}}</text>
            </view>
            <view class="due-info">
              <text class="iconfont icon-time">â°</text>
              <text class="due-text">æˆªæ­¢ï¼š{{item.formattedDueTime}}</text>
              <text class="time-left {{item.urgentClass}}">
                {{item.timeLeftText}}
              </text>
            </view>
          </view>
          <view class="card-footer">
            <view class="status-tag status-{{item.status}}">
              {{['æœªå¼€å§‹','è¿›è¡Œä¸­','å·²å®Œæˆ'][item.status]}}
            </view>
            <view class="action-buttons">
              <button 
                class="btn-quick-action" 
                size="mini"
                data-id="{{item.id}}"
                bindtap="markAsComplete"
                catchtap
                wx:if="{{item.status !== 2}}"
              >
                æ ‡è®°å®Œæˆ
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{showEmptyState}}">
      <view class="empty-image">ğŸ“</view>
      <text class="empty-title">æš‚æ— ä½œä¸š</text>
      <text class="empty-desc">æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä½œä¸šä»»åŠ¡å§</text>
      <button class="btn-primary" bindtap="goToAddAssignment">
        <text class="iconfont icon-add">+</text>
        æ·»åŠ ä½œä¸š
      </button>
    </view>
  </scroll-view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="fab-container">
    <button class="fab-button" bindtap="goToAddAssignment">
      <text class="fab-icon">+</text>
    </button>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <view class="filter-content">
      <view class="filter-header">
        <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
        <text class="iconfont icon-close" bindtap="hideFilterPanel">âœ•</text>
      </view>
      <!-- ç­›é€‰é€‰é¡¹ -->
    </view>
  </view>
</view>