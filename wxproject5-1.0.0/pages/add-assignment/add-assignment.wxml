<!-- pages/add-assignment/add-assignment.wxml -->
<view class="add-page">
  <!-- å¤´éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="nav-back" bindtap="goBack">è¿”å›</view>
    <text class="title">{{mode === 'add' ? 'æ·»åŠ ä½œä¸š' : 'ç¼–è¾‘ä½œä¸š'}}</text>
    <view class="nav-save" bindtap="onSave">ä¿å­˜</view>
  </view>

  <!-- è¡¨å•åŒºåŸŸ -->
  <scroll-view class="form-container" scroll-y>
    <!-- åŸºç¡€ä¿¡æ¯ -->
    <view class="form-section">
      <text class="section-title">ğŸ“ åŸºç¡€ä¿¡æ¯</text>
      
      <!-- ä½œä¸šæ ‡é¢˜ -->
      <view class="form-item">
        <text class="item-label required">ä½œä¸šæ ‡é¢˜</text>
        <input
          class="input {{errors.title ? 'error' : ''}}"
          placeholder="è¯·è¾“å…¥ä½œä¸šæ ‡é¢˜"
          value="{{formData.title}}"
          data-field="title"
          bindinput="onInputChange"
          maxlength="50"
        />
        <text class="error-msg" wx:if="{{errors.title}}">{{errors.title}}</text>
        <text class="hint" wx:if="!errors.title">æœ€å¤š50ä¸ªå­—</text>
      </view>
      
      <!-- è¯¾ç¨‹é€‰æ‹© -->
      <view class="form-item">
        <text class="item-label required">æ‰€å±è¯¾ç¨‹</text>
        <picker
          class="picker {{errors.courseId ? 'error' : ''}}"
          range="{{courses}}"
          range-key="name"
          value="{{courseIndex}}"
          bindchange="onCourseChange"
        >
          <view class="picker-view">
            {{selectedCourseName}}
          </view>
        </picker>
        <text class="error-msg" wx:if="{{errors.courseId}}">{{errors.courseId}}</text>
      </view>
      
      <!-- æˆªæ­¢æ—¶é—´ -->
      <view class="form-item">
        <text class="item-label">æˆªæ­¢æ—¶é—´</text>
        <view class="time-picker">
          <picker
            mode="date"
            value="{{date}}"
            start="{{today}}"
            end="{{maxDate}}"
            bindchange="onDateChange"
          >
            <view class="time-item">{{date || 'é€‰æ‹©æ—¥æœŸ'}}</view>
          </picker>
          <text class="time-separator">-</text>
          <picker
            mode="time"
            value="{{time}}"
            bindchange="onTimeChange"
          >
            <view class="time-item">{{time || 'é€‰æ‹©æ—¶é—´'}}</view>
          </picker>
        </view>
        <text class="hint" wx:if="{{formData.dueDate}}">
          æˆªæ­¢ï¼š{{formatDate(formData.dueDate, 'YYYYå¹´MMæœˆDDæ—¥ HH:mm')}}
        </text>
      </view>
    </view>

    <!-- è¯¦ç»†è®¾ç½® -->
    <view class="form-section">
      <text class="section-title">âš™ï¸ è¯¦ç»†è®¾ç½®</text>
      
      <!-- ä¼˜å…ˆçº§ -->
      <view class="form-item">
        <text class="item-label">ä¼˜å…ˆçº§</text>
        <view class="priority-options">
          <view
            class="priority-option {{formData.priority === 0 ? 'active' : ''}}"
            data-priority="0"
            bindtap="onPriorityChange"
          >
            <view class="priority-dot low"></view>
            <text>ä½</text>
          </view>
          <view
            class="priority-option {{formData.priority === 1 ? 'active' : ''}}"
            data-priority="1"
            bindtap="onPriorityChange"
          >
            <view class="priority-dot medium"></view>
            <text>ä¸­</text>
          </view>
          <view
            class="priority-option {{formData.priority === 2 ? 'active' : ''}}"
            data-priority="2"
            bindtap="onPriorityChange"
          >
            <view class="priority-dot high"></view>
            <text>é«˜</text>
          </view>
        </view>
      </view>
      
      <!-- çŠ¶æ€ -->
      <view class="form-item">
        <text class="item-label">å½“å‰çŠ¶æ€</text>
        <view class="status-options">
          <view
            class="status-option {{formData.status === 0 ? 'active' : ''}}"
            data-status="0"
            bindtap="onStatusChange"
          >
            <text>æœªå¼€å§‹</text>
          </view>
          <view
            class="status-option {{formData.status === 1 ? 'active' : ''}}"
            data-status="1"
            bindtap="onStatusChange"
          >
            <text>è¿›è¡Œä¸­</text>
          </view>
          <view
            class="status-option {{formData.status === 2 ? 'active' : ''}}"
            data-status="2"
            bindtap="onStatusChange"
          >
            <text>å·²å®Œæˆ</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä½œä¸šæè¿° -->
    <view class="form-section">
      <text class="section-title">ğŸ“„ ä½œä¸šæè¿°</text>
      <view class="form-item">
        <textarea
          class="textarea"
          placeholder="è¯·è¾“å…¥ä½œä¸šè¯¦ç»†æè¿°ã€è¦æ±‚ç­‰..."
          value="{{formData.description}}"
          data-field="description"
          bindinput="onInputChange"
          maxlength="500"
          auto-height
        />
        <view class="word-count">{{(formData.description && formData.description.length) || 0}}/500</view>
      </view>
    </view>
  </scroll-view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <!-- åˆ é™¤æŒ‰é’®ï¼ˆä»…ç¼–è¾‘æ¨¡å¼ï¼‰ -->
    <button 
      class="btn-delete" 
      wx:if="{{mode === 'edit'}}"
      bindtap="onDelete"
    >
      åˆ é™¤ä½œä¸š
    </button>
    
    <!-- å–æ¶ˆæŒ‰é’® -->
    <button class="btn-cancel" bindtap="onCancel">å–æ¶ˆ</button>
    
    <!-- ä¿å­˜æŒ‰é’® -->
    <button class="btn-save" bindtap="onSave">
      {{mode === 'add' ? 'æ·»åŠ ä½œä¸š' : 'ä¿å­˜ä¿®æ”¹'}}
    </button>
  </view>
</view>