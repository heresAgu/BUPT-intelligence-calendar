<!-- pages/links/links.wxml -->
<view class="links-page">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="title">ğŸ”— å¸¸ç”¨é“¾æ¥</view>
    <view class="subtitle">å¿«é€Ÿè®¿é—®å­¦ä¹ èµ„æºä¸ä½œä¸šå¹³å°</view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <input
      class="search-input"
      placeholder="æœç´¢é“¾æ¥æˆ–å¹³å°"
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
      bindconfirm="onSearch"
    />
    <view class="search-btn" bindtap="onSearch">æœç´¢</view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <scroll-view class="category-tabs" scroll-x>
    <view 
      class="tab {{activeCategory === 'all' ? 'active' : ''}}"
      data-category="all"
      bindtap="changeCategory"
    >å…¨éƒ¨</view>
    <view 
      class="tab {{activeCategory === 'homework' ? 'active' : ''}}"
      data-category="homework"
      bindtap="changeCategory"
    >ä½œä¸šå¹³å°</view>
    <view 
      class="tab {{activeCategory === 'course' ? 'active' : ''}}"
      data-category="course"
      bindtap="changeCategory"
    >è¯¾ç¨‹ç›¸å…³</view>
    <view 
      class="tab {{activeCategory === 'school' ? 'active' : ''}}"
      data-category="school"
      bindtap="changeCategory"
    >å­¦æ ¡ç½‘ç«™</view>
    <view 
      class="tab {{activeCategory === 'tool' ? 'active' : ''}}"
      data-category="tool"
      bindtap="changeCategory"
    >å·¥å…·èµ„æº</view>
    <view 
      class="tab {{activeCategory === 'custom' ? 'active' : ''}}"
      data-category="custom"
      bindtap="changeCategory"
    >è‡ªå®šä¹‰</view>
  </scroll-view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="action-card" bindtap="addLink">
      <view class="action-icon">â•</view>
      <view class="action-text">æ·»åŠ é“¾æ¥</view>
    </view>
    <view class="action-card" bindtap="scanQRCode">
      <view class="action-icon">ğŸ“·</view>
      <view class="action-text">æ‰«ç æ·»åŠ </view>
    </view>
    <view class="action-card" bindtap="importFromCourses">
      <view class="action-icon">ğŸ“š</view>
      <view class="action-text">å¯¼å…¥è¯¾ç¨‹é“¾æ¥</view>
    </view>
  </view>

  <!-- é“¾æ¥åˆ—è¡¨ -->
  <scroll-view class="links-list" scroll-y>
    <!-- æœ€è¿‘ä½¿ç”¨ -->
    <view class="section" wx:if="{{recentLinks.length > 0}}">
      <view class="section-title">
        <view class="title-text">æœ€è¿‘ä½¿ç”¨</view>
        <view class="title-extra">{{recentLinks.length}}ä¸ª</view>
      </view>
      <view class="recent-grid">
        <view 
          class="recent-item"
          wx:for="{{recentLinks}}"
          wx:key="id"
          data-index="{{index}}"
          bindtap="openLink"
        >
          <view class="recent-icon" style="background-color: {{item.color || '#1890ff'}}">
            {{item.icon || 'ğŸ”—'}}
          </view>
          <view class="recent-info">
            <view class="recent-name">{{item.name}}</view>
            <view class="recent-desc">{{item.category}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å¸¸ç”¨é“¾æ¥ -->
    <view class="section">
      <view class="section-title">
        <view class="title-text">å¸¸ç”¨é“¾æ¥</view>
        <view class="title-extra">{{filteredLinks.length}}ä¸ª</view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredLinks.length === 0}}">
        <view class="empty-icon">ğŸ”—</view>
        <view class="empty-title">æš‚æ— é“¾æ¥</view>
        <view class="empty-desc">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ å¸¸ç”¨é“¾æ¥</view>
        <button class="empty-btn" bindtap="addLink">ç«‹å³æ·»åŠ </button>
      </view>

      <!-- é“¾æ¥å¡ç‰‡ -->
      <view class="link-grid" wx:else>
        <view 
          class="link-card"
          wx:for="{{filteredLinks}}"
          wx:key="id"
          data-index="{{index}}"
          bindtap="openLink"
          bindlongpress="showLinkMenu"
        >
          <view class="card-header" style="background-color: {{item.color || '#1890ff'}}20">
            <view class="card-icon">{{item.icon || 'ğŸ”—'}}</view>
            <view class="card-actions">
              <view 
                class="btn-star {{item.starred ? 'starred' : ''}}" 
                data-id="{{item.id}}"
                catchtap="toggleStar"
              >
                {{item.starred ? 'â˜…' : 'â˜†'}}
              </view>
            </view>
          </view>
          <view class="card-content">
            <view class="card-title">{{item.name}}</view>
            <view class="card-url">{{formatUrl(item.url)}}</view>
            <view class="card-tags">
              <view class="tag">{{item.category}}</view>
              <view class="tag">{{item.usageCount || 0}}æ¬¡</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¨èå¹³å° -->
    <view class="section" wx:if="{{presetPlatforms && presetPlatforms.length > 0}}">
      <view class="section-header">
        <view class="section-title">
          <view class="title-text">æ¨èå¹³å°</view>
          <view class="title-extra">ä½œä¸šå¹³å° {{getUnaddedCount()}}ä¸ª</view>
        </view>
        <view 
          class="add-all-btn {{isAddingAll ? 'adding' : ''}}"
          bindtap="addAllPlatforms"
        >
          {{isAddingAll ? 'æ·»åŠ ä¸­...' : 'ä¸€é”®æ·»åŠ '}}
        </view>
      </view>
      <view class="platform-grid">
        <view 
          class="platform-card"
          wx:for="{{presetPlatforms}}"
          wx:key="id"
          data-index="{{index}}"
          bindtap="quickAddPlatform"
        >
          <view class="platform-icon" style="background-color: {{item.color}}20; color: {{item.color}}">
            {{item.icon}}
          </view>
          <view class="platform-name">{{item.name}}</view>
          <view class="add-btn {{item.added ? 'added' : ''}}">
            {{item.added ? 'âœ“' : '+'}}
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- æ·»åŠ é“¾æ¥æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="closeModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">æ·»åŠ é“¾æ¥</view>
        <view class="modal-close" bindtap="closeModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <view class="form-label">é“¾æ¥åç§°</view>
          <input 
            class="form-input"
            placeholder="ä¾‹å¦‚ï¼šé«˜æ•°ä½œä¸š"
            value="{{newLink.name}}"
            bindinput="onNewLinkInput"
            data-field="name"
          />
        </view>
        <view class="form-item">
          <view class="form-label">é“¾æ¥åœ°å€</view>
          <input 
            class="form-input"
            placeholder="https://example.com"
            value="{{newLink.url}}"
            bindinput="onNewLinkInput"
            data-field="url"
          />
        </view>
        <view class="form-item">
          <view class="form-label">åˆ†ç±»</view>
          <picker 
            range="{{categoryOptions}}" 
            value="{{newLink.categoryIndex}}" 
            bindchange="onCategoryChange"
          >
            <view class="picker-input">{{categoryOptions[newLink.categoryIndex]}}</view>
          </picker>
        </view>
        <view class="form-item">
          <view class="form-label">å›¾æ ‡</view>
          <view class="icon-options">
            <view 
              class="icon-option {{newLink.icon === icon ? 'selected' : ''}}"
              wx:for="{{iconOptions}}"
              wx:key="*this"
              data-icon="{{icon}}"
              bindtap="selectIcon"
            >
              {{icon}}
            </view>
          </view>
        </view>
        <view class="form-actions">
          <button class="btn-cancel" bindtap="closeModal">å–æ¶ˆ</button>
          <button class="btn-submit" bindtap="saveLink">ä¿å­˜</button>
        </view>
      </view>
    </view>
  </view>
</view>