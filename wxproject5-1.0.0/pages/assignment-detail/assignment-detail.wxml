<!-- pages/assignment-detail/assignment-detail.wxml -->
<view class="detail-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:elif="{{isError}}">
    <view class="error-icon">âŒ</view>
    <text class="error-title">åŠ è½½å¤±è´¥</text>
    <text class="error-desc">{{errorMsg || 'ä½œä¸šä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤'}}</text>
    <button class="btn-primary" bindtap="goBack">è¿”å›åˆ—è¡¨</button>
  </view>

  <!-- æ­£å¸¸å†…å®¹ -->
  <view class="content" wx:else>
    <!-- å¤´éƒ¨å¡ç‰‡ -->
    <view class="header-card">
      <!-- ä¼˜å…ˆçº§æ ‡ç­¾ -->
      <view class="priority-label priority-{{assignment.priority}}">
        {{['ä½','ä¸­','é«˜'][assignment.priority]}}ä¼˜å…ˆçº§
      </view>
      
      <!-- æ ‡é¢˜ -->
      <view class="title">{{assignment.title}}</view>
      
      <!-- çŠ¶æ€æ ‡ç­¾ -->
      <view class="status-badge status-{{assignment.status}}">
        {{['æœªå¼€å§‹','è¿›è¡Œä¸­','å·²å®Œæˆ'][assignment.status]}}
      </view>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="info-section">
        <text class="section-title">ğŸ“š è¯¾ç¨‹ä¿¡æ¯</text>
        <view class="info-row">
          <text class="info-label">è¯¾ç¨‹åç§°ï¼š</text>
          <text class="info-value">{{assignment.courseName || 'æœªåˆ†ç±»'}}</text>
        </view>
        <view class="info-row" wx:if="{{assignment.teacher}}">
          <text class="info-label">ä»»è¯¾è€å¸ˆï¼š</text>
          <text class="info-value">{{assignment.teacher}}</text>
        </view>
      </view>

      <view class="info-section">
        <text class="section-title">â° æ—¶é—´ä¿¡æ¯</text>
        <view class="info-row">
          <text class="info-label">æˆªæ­¢æ—¶é—´ï¼š</text>
          <text class="info-value">{{assignment.formattedDueTime || 'æ— æˆªæ­¢æ—¶é—´'}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">å‰©ä½™æ—¶é—´ï¼š</text>
          <text class="info-value time-left {{assignment.urgentClass}}">
            {{assignment.timeLeftText}}
          </text>
        </view>
        <view class="info-row" wx:if="{{assignment.createdAt}}">
          <text class="info-label">åˆ›å»ºæ—¶é—´ï¼š</text>
          <text class="info-value">{{assignment.createdAtText}}</text>
        </view>
        <view class="info-row" wx:if="{{assignment.completedAt}}">
          <text class="info-label">å®Œæˆæ—¶é—´ï¼š</text>
          <text class="info-value">{{assignment.completedAtText}}</text>
        </view>
      </view>

      <view class="info-section" wx:if="{{assignment.description}}">
        <text class="section-title">ğŸ“ ä½œä¸šæè¿°</text>
        <view class="description">{{assignment.description}}</view>
      </view>

      <!-- é™„ä»¶åŒºåŸŸï¼ˆé¢„ç•™ï¼‰ -->
      <view class="info-section" wx:if="{{assignment.attachments && assignment.attachments.length > 0}}">
        <text class="section-title">ğŸ“ é™„ä»¶</text>
        <view class="attachments">
          <view class="attachment-item" wx:for="{{assignment.attachments}}" wx:key="index">
            <text class="attachment-name">{{item.name}}</text>
            <button class="btn-download" size="mini">ä¸‹è½½</button>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
    <view class="action-card">
      <view class="action-buttons">
        <!-- æ ‡è®°å®Œæˆ/å–æ¶ˆå®Œæˆ -->
        <button 
          class="btn-action btn-complete" 
          wx:if="{{assignment.status !== 2}}"
          bindtap="markAsComplete"
        >
          <text class="icon">âœ…</text>
          æ ‡è®°å®Œæˆ
        </button>
        <button 
          class="btn-action btn-undo" 
          wx:else
          bindtap="markAsIncomplete"
        >
          <text class="icon">â†©ï¸</text>
          å–æ¶ˆå®Œæˆ
        </button>

        <!-- ç¼–è¾‘æŒ‰é’® -->
        <button 
          class="btn-action btn-edit"
          bindtap="editAssignment"
        >
          <text class="icon">âœï¸</text>
          ç¼–è¾‘ä½œä¸š
        </button>

        <!-- åˆ é™¤æŒ‰é’® -->
        <button 
          class="btn-action btn-delete"
          bindtap="deleteAssignment"
        >
          <text class="icon">ğŸ—‘ï¸</text>
          åˆ é™¤ä½œä¸š
        </button>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area"></view>
  </view>
</view>